{
  "Parameters": {
    "AMIID": {
      "Type" : "String"
    },
    "NETWORK": {
      "Type": "String"
    }

  },

  "AWSTemplateFormatVersion": "2010-09-09",

  "Resources": {

    "EC2Instance" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
        "ImageId" : {"Ref" : "AMIID"},
        "InstanceType": "t2.micro",
        "KeyName" : "centos",
        "BlockDeviceMappings" : [
          {
            "DeviceName" : "/dev/sda",
            "Ebs" : {
              "VolumeType" : "gp2",
              "DeleteOnTermination" : false,
              "VolumeSize" : "20"
            }
          }
        ],
        "NetworkInterfaces": [ {
          "AssociatePublicIpAddress": true,
          "GroupSet": [{ "Ref" : "WebSecurityGroup" }],
          "SubnetId": [{"Fn::ImportValue" : {"Fn::Sub" : "${NETWORK}-SubnetID3"}}]
        } ]
      }
    },

    "myDBSubnetGroup": {
      "Type": "AWS::RDS::DBSubnetGroup",
      "Properties": {
        "DBSubnetGroupDescription": "description",
        "SubnetIds": [

          {"Fn::ImportValue" : {"Fn::Sub" : "${NETWORK}-SubnetID1"}},
          {"Fn::ImportValue" : {"Fn::Sub" : "${NETWORK}-SubnetID2"}}

        ],
        "Tags": [
          {
            "Key": "String",
            "Value": "String"
          }
        ]
      }
    },

    "WebSecurityGroup" : {
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
        "GroupDescription" : "Allow http to client host",

        "VpcId" : {"Fn::ImportValue" : {"Fn::Sub" : "${NETWORK}-VPC"}},

        "SecurityGroupIngress" : [
          {
            "IpProtocol" : "tcp",
            "FromPort" : 22,
            "ToPort" : 22,
            "CidrIp" : "0.0.0.0/0"
          },
          {
            "IpProtocol" : "tcp",
            "FromPort" : 80,
            "ToPort" : 80,
            "CidrIp" : "0.0.0.0/0"
          },
          {
            "IpProtocol" : "tcp",
            "FromPort" : 443,
            "ToPort" : 443,
            "CidrIp" : "0.0.0.0/0"
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 5432,
            "ToPort": 5432,
            "CidrIp": "0:0:0:0/0"
          }
        ]
      }
    },

    "DBSecurityGroup" : {
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
        "GroupDescription" : "Allow http to client host",
        "VpcId" : {"Fn::ImportValue" : {"Fn::Sub" : "${NETWORK}-VPC"}},
        "SecurityGroupIngress" : [{"Ref": "WebSecurityGroup"}]
      }
    },

    "PostGresDB": {
      "Type": "AWS::RDS::DBInstance",
      "Properties": {
        "AllocatedStorage": "5",
        "Engine": "PostgreSQL",
        "EngineVersion": "10.6-R1",
        "DBInstanceClass": "db.t2.micro",
        "MultiAZ": false,
        "DBInstanceIdentifier": "csye6225-su19",
        "MasterUsername": "csye6225master",
        "MasterUserPassword": "csye6225password",

        "DBSubnetGroupName": {"Ref": "myDBSubnetGroup"},
        "PubliclyAccessible": true,

        "DBName": "csye6225",
        "VPCSecurityGroups": {"Ref": "DBSecurityGroup"},
        "Tags": [
          {
            "Key": "Name",
            "Value": "PostgreSQL Database"
          }
        ]
      },
      "DeletionPolicy": "Snapshot"
    }
  }
}