{
  "Parameters": {
    "CidrVPC": {
      "Type" : "String"
    },
    "CidrSubnet1": {
      "Type" : "String"
    },
    "CidrSubnet2": {
      "Type" : "String"
    },
    "CidrSubnet3": {
      "Type" : "String"
    },
    "AMI_ID": {
      "Type" : "String"
    }

  },

  "AWSTemplateFormatVersion": "2010-09-09",

  "Resources": {

    "EC2Instance" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
        "ImageId" : {"Ref" : "AMI_ID"},
        "KeyName" : "centos",
        "BlockDeviceMappings" : [
          {
            "DeviceName" : "/dev/sda",
            "Ebs" : {
              "VolumeType" : "gp2",
              "DeleteOnTermination" : false,
              "VolumeSize" : "20"
            }
          }
        ],
        "NetworkInterfaces": [ {
          "AssociatePublicIpAddress": true,
          "DeviceIndex": "0",
          "GroupSet": [{ "Ref" : "WebSecurityGroup" }],
          "SubnetId": { "Ref" : "CidrSubnet3" }
        } ]
      }
    },

    "myDBSubnetGroup": {
      "Type": "AWS::RDS::DBSubnetGroup",
      "Properties": {
        "DBSubnetGroupDescription": "description",
        "SubnetIds": [
          {"Ref" : "CidrSubnet1"},
          {"Ref" : "CidrSubnet2"}
        ],
        "Tags": [
          {
            "Key": "String",
            "Value": "String"
          }
        ]
      }
    },

    "WebSecurityGroup" : {
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
        "GroupDescription" : "Allow http to client host",
        "VpcId" : {"Ref" : "CidrVPC"},
        "SecurityGroupIngress" : [
          {
            "IpProtocol" : "tcp",
            "FromPort" : 22,
            "ToPort" : 22,
            "CidrIp" : "0.0.0.0/0"
          },
          {
            "IpProtocol" : "tcp",
            "FromPort" : 80,
            "ToPort" : 80,
            "CidrIp" : "0.0.0.0/0"
          },
          {
            "IpProtocol" : "tcp",
            "FromPort" : 443,
            "ToPort" : 443,
            "CidrIp" : "0.0.0.0/0"
          }
        ]
      }
    },

    "DBSecurityGroup" : {
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
        "GroupDescription" : "Allow http to client host",
        "VpcId" : {"Ref" : "CidrVPC"},
        "SecurityGroupIngress" : [{
          "IpProtocol" : "tcp",
          "FromPort" : 5432,
          "ToPort" : 5432,
          "CidrIp" : {"Ref" : "WebSecurityGroup"}
        }]
      }
    },

    "PostGresDB": {
      "Type": "AWS::RDS::DBInstance",
      "Properties": {
        "AllocatedStorage": "5",
        "Engine": "PostgreSQL",
        "EngineVersion": "10.6-R1",
        "DBInstanceClass": "db.t2.micro",
        "MultiAZ": false,
        "DBInstanceIdentifier": "csye6225-su19",
        "MasterUsername": "csye6225master",
        "MasterUserPassword": "csye6225password",
        "DBSubnetGroupName": "",
        "PubliclyAccessible": true,
        "DBName": "csye6225",
        "VPCSecurityGroups": {"Ref": "DBSecurityGroup"},
        "Tags": [
          {
            "Key": "Name",
            "Value": "PostgreSQL Database"
          }
        ]
      },
      "DeletionPolicy": "Snapshot"
    }


  }

}